(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[53],{3595:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dao",function(){return n(4100)}])},8226:function(e,t,n){"use strict";var a=n(5893);n(7294);var r=n(6822),i=n(5861),s=n(8078);let o=e=>{let{label:t,value:n,symbol:o}=e;return(0,a.jsxs)(r.Z,{sx:l.card,children:[(0,a.jsx)(i.Z,{color:"text.secondary",fontSize:14,mt:0,children:t}),(0,a.jsxs)(r.Z,{sx:l.wrapper,children:[(0,a.jsx)(i.Z,{variant:"h6",my:0,mr:1,children:n?n.split(".")[0]:(0,a.jsx)(s.Z,{width:60})}),(0,a.jsx)(i.Z,{fontWeight:700,fontSize:12,color:"text.secondary",children:o})]})]})},l={container:{width:"100%",display:"flex",marginBottom:"30px",gap:2},card:{bgcolor:"background.paper",p:2,flex:1,borderRadius:2,boxShadow:1},wrapper:{display:"flex",alignItems:"flex-end"}};t.Z=o},4100:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return M}});var a=n(5893),r=n(4146),i=n(6371),s=n(9008),o=n.n(s),l=n(7294),c=JSON.parse('{"M":[{"inputs":[{"internalType":"address","name":"_chickenNFT","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"stateMutability":"payable","type":"fallback"},{"inputs":[{"internalType":"string","name":"_title","type":"string"},{"internalType":"string","name":"_url","type":"string"},{"internalType":"uint256","name":"_amount","type":"uint256"},{"internalType":"address payable","name":"_recipient","type":"address"}],"name":"createProposal","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"proposalIndex","type":"uint256"}],"name":"executeProposal","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"numProposals","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"proposals","outputs":[{"internalType":"uint256","name":"deadline","type":"uint256"},{"internalType":"uint256","name":"yayVotes","type":"uint256"},{"internalType":"uint256","name":"nayVotes","type":"uint256"},{"internalType":"bool","name":"executed","type":"bool"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"address","name":"recipient","type":"address"},{"internalType":"string","name":"title","type":"string"},{"internalType":"string","name":"url","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"proposalIndex","type":"uint256"},{"internalType":"enum ChickenDAO.Vote","name":"vote","type":"uint8"}],"name":"voteOnProposal","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdrawEther","outputs":[],"stateMutability":"nonpayable","type":"function"},{"stateMutability":"payable","type":"receive"}],"L":"0x3b470487dc5bd7738463b78EB161A7f2A35DC83C"}'),p=n(1378),d=n(7372),u=n(8226),y=n(4001),x=n(6822),h=n(8456),m=n(5861),g=n(6242),b=n(9417),f=n(7932),j=n(6886),w=n(9285),v=n(5553),Z=n(9485);let T=e=>{let{provider:t,daoContract:n,account:r,createProposalCallback:i}=e,[s,o]=(0,l.useState)(!1),[c,p]=l.useState({title:"",url:"",amount:0,recipient:""}),d=async()=>{if(!t)return;o(!0);let{title:e,url:a,amount:r,recipient:s}=c;u()||(console.error("the form is not valid"),o(!1));try{let t=await n.createProposal(e,a,v.parseEther(r.toString()),s,{gasLimit:1e6});await t.wait(),i()}catch(e){console.error(e)}o(!1)},u=()=>{let e=!0;return""===c.title&&(e=!1),""===c.url&&(e=!1),c.amount<0&&(e=!1),Z.isAddress(c.recipient)||(e=!1),e};return(0,a.jsxs)(x.Z,{sx:{my:4,display:"flex",flexDirection:"column"},children:[(0,a.jsx)(m.Z,{variant:"h3",sx:{marginBottom:2},children:"Create a Proposal"}),(0,a.jsx)(m.Z,{sx:{marginBottom:2},children:"Now you can create an proposal. Creating a proposal costs 10 EGGS"}),(0,a.jsx)(w.Z,{disabled:s,placeholder:"Your Proposal Title",label:"Title",fullWidth:!0,variant:"outlined",sx:{mb:2,bgcolor:"background.paper"},value:c.title,onChange:e=>p({...c,title:e.target.value})}),(0,a.jsx)(w.Z,{disabled:s,placeholder:"https://...",label:"External Link",fullWidth:!0,variant:"outlined",sx:{mb:2,bgcolor:"background.paper"},value:c.url,onChange:e=>p({...c,url:e.target.value})}),(0,a.jsx)(w.Z,{disabled:s,type:"number",placeholder:"Proposal Amount in SMR",label:"Proposal Amount in SMR",fullWidth:!0,variant:"outlined",value:c.amount,sx:{mb:2,bgcolor:"background.paper"},onChange:e=>p({...c,amount:e.target.value})}),(0,a.jsxs)(x.Z,{sx:{display:"flex",width:"100%",alignItems:"center",gap:2},children:[(0,a.jsx)(w.Z,{disabled:s,placeholder:r,label:"Recipient Address",fullWidth:!0,variant:"outlined",sx:{bgcolor:"background.paper"},value:c.recipient,onChange:e=>p({...c,recipient:e.target.value})}),(0,a.jsx)(b.Z,{disabled:s,color:"secondary",variant:"contained",onClick:()=>p({...c,recipient:r}),children:"Use my address"})]}),(0,a.jsx)(b.Z,{sx:{mt:2,height:40,alignSelf:"flex-start"},variant:"contained",onClick:d,children:"Create"})]})},{useChainId:C,useAccounts:P,useIsActivating:S,useIsActive:k,useProvider:V,useENSNames:A}=d.P;function M(){let[e,t]=(0,l.useState)("0"),[n,s]=(0,l.useState)("0"),[d,w]=(0,l.useState)([]),[v,Z]=(0,l.useState)(0),[C,S]=(0,l.useState)(""),[A,M]=(0,l.useState)(!1),E=P(),[_,N]=(0,l.useState)(""),O=V(),D=k();console.log("isActive",D),(0,l.useEffect)(()=>{D&&E&&E.length>0&&N(E[0])},[D,E]),(0,l.useEffect)(()=>{_&&(Y(),W(),I())},[_]);let Y=async()=>{if(O)try{let e=await O.getBalance(c.L);t(e.toString())}catch(e){console.error(e)}},I=async()=>{if(O)try{let e=G(O),t=await (null==e?void 0:e.numProposals());s(t.toString())}catch(e){console.error(e)}},W=async()=>{if(O){await O.getSigner();try{let e=H();console.log("nftContract",e);let t=await e.balanceOf(_);console.log("balance",t),Z(parseInt(t.toString()))}catch(e){console.error(e)}}},B=async e=>{if(console.log("fetchProposalById",e),O)try{let t=G(O),n=await (null==t?void 0:t.proposals(e)),a={proposalId:e,deadline:new Date(1e3*parseInt(n.deadline.toString())),yayVotes:n.yayVotes.toString(),nayVotes:n.nayVotes.toString(),executed:n.executed,recipient:n.recipient,amount:(0,i.formatEther)(n.amount),url:n.url,title:n.title};return a}catch(e){console.error(e)}},L=async()=>{try{let e=[];for(let t=0;t<Number(n);t++){let n=await B(t);console.log("proposal",n),e.push(n)}return w(e.reverse()),e}catch(e){console.error(e)}},R=async(e,t)=>{if(!O)return;let n=await O.getSigner();try{let a=G(n),r="YAY"===t?0:1;console.log("vote",r),console.log("proposalId",e);let i=await (null==a?void 0:a.voteOnProposal(e,r,{gasLimit:2e6}));M(!0),await i.wait(),M(!1),await L()}catch(e){console.error(e)}},F=async()=>{console.log("createdProposal"),await I(),S("View Proposals")},z=async e=>{if(!O)return;let t=await O.getSigner();try{let n=G(t),a=await (null==n?void 0:n.executeProposal(e));M(!0),await a.wait(),M(!1),await L()}catch(e){console.error(e),window.alert(e.data.message)}},G=e=>{if(O)return new r.CH(c.L,c.M,e)},H=()=>new r.CH(p.L,p.M,O);return(0,l.useEffect)(()=>{"View Proposals"===C&&L()},[C]),(0,a.jsxs)("div",{children:[(0,a.jsxs)(o(),{children:[(0,a.jsx)("title",{children:"ChickenDAO"}),(0,a.jsx)("meta",{name:"description",content:"CryptoDevs DAO"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,a.jsx)(y.Z,{children:(0,a.jsxs)(f.Z,{maxWidth:"md",children:[(0,a.jsx)(m.Z,{variant:"h3",gutterBottom:!0,children:"Welcome to the ChickenDAO!"}),(0,a.jsx)(m.Z,{variant:"subtitle1",children:"Welcome to the DAO!"}),(0,a.jsxs)(x.Z,{sx:{display:"flex",gap:4,flexWrap:"wrap",mb:4},children:[(0,a.jsx)(u.Z,{label:"Treasury Balance",value:(0,i.formatEther)(e),symbol:"SMR"}),(0,a.jsx)(u.Z,{label:"\uD83D\uDC14 Your ChickenNFT Balance:",value:v.toString(),symbol:"Chickens"})]}),(0,a.jsxs)(m.Z,{variant:"subtitle2",children:[(0,a.jsx)("br",{}),"Total Number of Proposals: ",n]}),(0,a.jsxs)(j.ZP,{container:!0,spacing:2,style:{marginTop:"1rem"},children:[(0,a.jsx)(j.ZP,{item:!0,children:(0,a.jsx)(b.Z,{variant:"contained",color:"primary",disabled:"Create Proposal"===C,onClick:()=>S("Create Proposal"),children:"Create Proposal"})}),(0,a.jsx)(j.ZP,{item:!0,children:(0,a.jsx)(b.Z,{variant:"contained",color:"primary",disabled:"View Proposals"===C,onClick:()=>S("View Proposals"),children:"View Proposals"})})]}),A&&(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",marginTop:"1rem"},children:(0,a.jsx)(h.Z,{})}),!A&&("Create Proposal"===C?A?(0,a.jsxs)(x.Z,{sx:{m:2},children:[(0,a.jsx)(h.Z,{}),"Waiting for transaction..."]}):0===v?(0,a.jsx)(x.Z,{sx:{m:2},children:(0,a.jsxs)(m.Z,{children:["You do not own any ChickenNFTs. ",(0,a.jsx)("br",{}),(0,a.jsx)(m.Z,{variant:"body1",fontWeight:"bold",children:"You cannot create or vote on proposals"})]})}):(0,a.jsx)(T,{provider:O,daoContract:G(null==O?void 0:O.getSigner()),account:_,createProposalCallback:F}):"View Proposals"===C?A?(0,a.jsxs)(x.Z,{sx:{m:2},children:[(0,a.jsx)(h.Z,{}),"Waiting for transaction..."]}):0===d.length?(0,a.jsx)(m.Z,{sx:{m:2},children:"No proposals have been created"}):(0,a.jsx)(x.Z,{children:d.map((e,t)=>(0,a.jsxs)(g.Z,{sx:{m:2,p:2,border:"1px solid #ddd"},children:[(0,a.jsxs)(m.Z,{variant:"h6",children:["Proposal ID: ",e.proposalId]}),(0,a.jsxs)(m.Z,{children:["Title: ",e.title]}),(0,a.jsxs)(m.Z,{children:["URL:"," ",(0,a.jsx)("a",{href:e.url,target:"_blank",rel:"noreferrer",children:e.url})]}),(0,a.jsxs)(m.Z,{children:["Amount: ",e.amount," SMR"]}),(0,a.jsxs)(m.Z,{children:["Recipient: ",e.recipient]}),(0,a.jsxs)(m.Z,{children:["Deadline: ",e.deadline.toLocaleString()]}),(0,a.jsxs)(m.Z,{children:["Yay Votes: ",e.yayVotes]}),(0,a.jsxs)(m.Z,{children:["Nay Votes: ",e.nayVotes]}),(0,a.jsxs)(m.Z,{children:["Executed?: ",e.executed.toString()]}),(0,a.jsx)(x.Z,{sx:{display:"flex",justifyContent:"space-between",m:2},children:e.deadline.getTime()>Date.now()&&!e.executed?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(b.Z,{variant:"contained",color:"primary",sx:{m:1},onClick:()=>R(e.proposalId,"YAY"),children:"Vote YAY"}),(0,a.jsx)(b.Z,{variant:"contained",color:"secondary",sx:{m:1},onClick:()=>R(e.proposalId,"NAY"),children:"Vote NAY"})]}):e.deadline.getTime()<Date.now()&&!e.executed?(0,a.jsxs)(b.Z,{variant:"contained",sx:{m:1},onClick:()=>z(e.proposalId),children:["Execute Proposal"," ",e.yayVotes>e.nayVotes?"(YAY)":"(NAY)"]}):(0,a.jsx)(m.Z,{sx:{m:2},children:"Proposal Executed"})})]},t))}):null)]})})]})}}},function(e){e.O(0,[881,364,146,581,886,52,833,774,888,179],function(){return e(e.s=3595)}),_N_E=e.O()}]);